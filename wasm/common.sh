#!/usr/bin/env bash

mkdir -p build/Common
pushd build/Common

clang++ \
    -c \
    --target=wasm32 -nostdlib -g -DWEBASM -DASSIMP_BUILD_SINGLETHREADED -D__wasi__ -DNDEBUG \
    -DASSIMP_BUILD_NO_AMF_IMPORTER -DASSIMP_BUILD_NO_3DS_IMPORTER -DASSIMP_BUILD_NO_MD3_IMPORTER -DASSIMP_BUILD_NO_MDL_IMPORTER -DASSIMP_BUILD_NO_MD2_IMPORTER \
    -DASSIMP_BUILD_NO_PLY_IMPORTER -DASSIMP_BUILD_NO_ASE_IMPORTER -DASSIMP_BUILD_NO_OBJ_IMPORTER -DASSIMP_BUILD_NO_HMP_IMPORTER -DASSIMP_BUILD_NO_SMD_IMPORTER \
    -DASSIMP_BUILD_NO_MDC_IMPORTER -DASSIMP_BUILD_NO_MD5_IMPORTER -DASSIMP_BUILD_NO_STL_IMPORTER -DASSIMP_BUILD_NO_LWO_IMPORTER -DASSIMP_BUILD_NO_DXF_IMPORTER \
    -DASSIMP_BUILD_NO_NFF_IMPORTER -DASSIMP_BUILD_NO_RAW_IMPORTER -DASSIMP_BUILD_NO_SIB_IMPORTER -DASSIMP_BUILD_NO_OFF_IMPORTER -DASSIMP_BUILD_NO_AC_IMPORTER \
    -DASSIMP_BUILD_NO_BVH_IMPORTER -DASSIMP_BUILD_NO_IRRMESH_IMPORTER -DASSIMP_BUILD_NO_IRR_IMPORTER -DASSIMP_BUILD_NO_Q3D_IMPORTER -DASSIMP_BUILD_NO_B3D_IMPORTER \
    -DASSIMP_BUILD_NO_COLLADA_IMPORTER -DASSIMP_BUILD_NO_TERRAGEN_IMPORTER -DASSIMP_BUILD_NO_CSM_IMPORTER -DASSIMP_BUILD_NO_3D_IMPORTER -DASSIMP_BUILD_NO_LWS_IMPORTER \
    -DASSIMP_BUILD_NO_OGRE_IMPORTER -DASSIMP_BUILD_NO_OPENGEX_IMPORTER -DASSIMP_BUILD_NO_MS3D_IMPORTER -DASSIMP_BUILD_NO_COB_IMPORTER -DASSIMP_BUILD_NO_BLEND_IMPORTER \
    -DASSIMP_BUILD_NO_Q3BSP_IMPORTER -DASSIMP_BUILD_NO_NDO_IMPORTER -DASSIMP_BUILD_NO_IFC_IMPORTER -DASSIMP_BUILD_NO_XGL_IMPORTER -DASSIMP_BUILD_NO_ASSBIN_IMPORTER \
    -DASSIMP_BUILD_NO_GLTF_IMPORTER -DASSIMP_BUILD_NO_C4D_IMPORTER -DASSIMP_BUILD_NO_3MF_IMPORTER -DASSIMP_BUILD_NO_X3D_IMPORTER -DASSIMP_BUILD_NO_MMD_IMPORTER \
    -DASSIMP_BUILD_NO_M3D_IMPORTER -DASSIMP_BUILD_NO_X_IMPORTER \
    -DASSIMP_BUILD_NO_COLLADA_EXPORTER -DASSIMP_BUILD_NO_X_EXPORTER -DASSIMP_BUILD_NO_STEP_EXPORTER -DASSIMP_BUILD_NO_OBJ_EXPORTER -DASSIMP_BUILD_NO_STL_EXPORTER \
    -DASSIMP_BUILD_NO_PLY_EXPORTER  -DASSIMP_BUILD_NO_3DS_EXPORTER -DASSIMP_BUILD_NO_GLTF_EXPORTER -DASSIMP_BUILD_NO_ASSBIN_EXPORTER -DASSIMP_BUILD_NO_ASSXML_EXPORTER \
    -DASSIMP_BUILD_NO_X3D_EXPORTER -DASSIMP_BUILD_NO_FBX_EXPORTER -DASSIMP_BUILD_NO_3MF_EXPORTER -DASSIMP_BUILD_NO_M3D_EXPORTER -DASSIMP_BUILD_NO_PBRT_EXPORTER \
    -fvisibility=hidden \
    -mthread-model single \
    -fno-threadsafe-statics \
    -fwasm-exceptions \
    -std=c++11 \
    -I../../../code \
    -I../../../include \
    -I../../../contrib \
    -I../../../contrib/unzip \
    -I../../../contrib/zlib \
    -I../../../ \
    -Wall \
    --sysroot=${WASI_SDK_HOME}/share/wasi-sysroot \
    ../../../code/Common/*.cpp \
    ../../../code/Material/*.cpp \
    ../../../code/CApi/*.cpp \

    

llvm-ar \
    rc ./Common.a \
    *.o

popd


