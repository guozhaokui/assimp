
<script type="module">
/*
  async function init() {
    const { instance } = await WebAssembly.instantiateStreaming(
      fetch("./add.wasm")
    );
    console.log(instance.exports.add(4, 1));
  }
  init();
  
*/  
    //import {test} from './build/hello/hello.js';
    
    let utf8decoder = new TextDecoder( "utf-8" );
    let mem = new WebAssembly.Memory( {'initial':32} );
    //imports['memory'] = 

    async function init(){
    const response = await fetch("./build/assimp.wasm");
    const buffer = await response.arrayBuffer();
    const obj = await WebAssembly.instantiate(buffer,{
        BTJSRT:{
            log:(str,len,f1,f2,f3)=>{
                let arr = mem.buffer.slice( str, str+len );
                console.log( utf8decoder.decode(arr),f1,f2,f3 );
            },
            logs:(str)=>{
              console.log(str);
            },
            realpath(path, resolved_path){
            }
        },
        wasi_snapshot_preview1:{
          fd_close:()=>{debugger;},
            fd_seek:()=>{debugger;},
            fd_fdstat_get:()=>{debugger;},
            fd_prestat_get:()=>{debugger;},
            fd_prestat_dir_name:()=>{debugger;},
            fd_write:()=>{debugger;},
            proc_exit:()=>{debugger;},
            path_open:()=>{debugger;},
            path_filestat_get:()=>{debugger;},
            path_unlink_file:()=>{debugger;},
            path_remove_directory:()=>{debugger;},
            path_create_directory:()=>{debugger;},
            fd_fdstat_set_flags:()=>{debugger;},
            fd_read:()=>{debugger;},
            environ_sizes_get:()=>{debugger;},
            environ_get:()=>{debugger;},
            clock_time_get:()=>{debugger;},
            __wasm_lpad_context:()=>{}
        },
        env: {
            memory:mem,
            __cxa_begin_catch:()=>{debugger;},
            __cxa_end_catch:()=>{debugger;},
            __cxa_throw:()=>{debugger;},
            __cxa_rethrow:()=>{debugger;},
            __cxa_allocate_exception:()=>{debugger;},
            __cxa_free_exception:()=>{debugger;},
            __multi3:()=>{debugger;},
            __lttf2:()=>{debugger;},
            realpath:()=>{debugger;},
            _Unwind_CallPersonality:()=>{debugger;},
          }
    });
    console.log(obj.instance.exports.test());  // "3"  
    }
    init();
</script>